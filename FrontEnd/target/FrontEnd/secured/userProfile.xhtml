<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets">
<h:head>
    <title>Profile</title>

    <style>
        .container {
            width: 50%;
            height: 50%;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script>


        $(function() {
            var username = document.getElementById("username").value;
            var url = "http://192.168.99.100:9000/diagram/get/" + username;
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function(data, textStatus, xhr){

                    if(xhr.status==200){
                        var x = data.x;
                        var y = data.y;
                        var z = data.z;
                        var diagramType = data.chart;
                        var diagramData = [x, y, z];
                        var labels = ["X", "Y", "Z"];
                        renderChart(diagramData, labels, diagramType);
                    }
                    else {
                        $('#result').text("Error " + xhr.responseText+"---"+xhr+"---"+xhr.status+"---"+xhr+"---");
                    }
                    //Do work
                },
                error: function(xhr, ajaxOptions, thrownError) {
                    console.log("========================== fail ==========================");
                    $('#result').text(thrownError);
                }
            });


        });

        function renderChart(data, labels, type) {
            var ctx = document.getElementById("myChart").getContext('2d');
            if(type=="bar"){
                var myChart = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'My Diagram',
                            data: data,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255,99,132,1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true
                                }
                            }]
                        }
                    }
                });


            }else if(type=="pie"){
                var myChart = new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'My Diagram',
                            data: data,
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(255, 206, 86, 0.2)',
                                'rgba(75, 192, 192, 0.2)',
                                'rgba(153, 102, 255, 0.2)',
                                'rgba(255, 159, 64, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255,99,132,1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        cutoutPercentage: 0.9
                    }
                });

            }
        }
    </script>
</h:head>
<h:body>
    <h:form>

            <h:outputLabel>Welcome </h:outputLabel>
            <h:outputLabel>#{logIn.userName} </h:outputLabel>
            <br/>
            <br/>
        <h:outputLabel>Log: </h:outputLabel>
        <ui:repeat var="UserLog" value="#{log.getLogs()}">
             #{UserLog.message}, #{UserLog.date} <br></br>
        </ui:repeat>
        <br/>
        <br/>
        <h:commandButton id="logBtn" type="submit" action="#{navigation.toLog()}" value="Post"></h:commandButton>
        &#xA0; &#xA0;
        <h:commandButton id="sendMessageBtn" type="submit" action="#{navigation.toMessage()}" value="Send Message"></h:commandButton>
        &#xA0; &#xA0;
        <h:commandButton id="inboxBtn" type="submit" action="#{navigation.toInbox()}" value="Inbox"></h:commandButton>
        &#xA0; &#xA0;
        <h:commandButton id="sentBtn" type="submit" action="#{navigation.toSentMessages()}" value="sentMessages"></h:commandButton>

        &#xA0; &#xA0;
        <nav>
            <a href="http://192.168.99.100:7000/FrontEnd/faces/secured/public/index.html" style="font-family: 'Times New Roman', Times, serif;color:blue;"> Draw </a>
        </nav>
        <h:commandButton id="chartBtn" type="submit" action="#{navigation.toChart()}" value="Chart"></h:commandButton>
        <br/>
        <br/>
        <h:inputText value="#{search.findUser}"> </h:inputText>
        <br/>
        <br/>

        <h:commandButton id="searchBtn" type="submit" action="#{search.findUser()}" value="Search"></h:commandButton>
        <br/>
        <br/>
        <h:commandButton id="createBtn" type="submit" action="#{logIn.logOut()}" value="Log Out"></h:commandButton>


    </h:form>
    <div class="container">
        <canvas id="myChart"></canvas>
    </div>
    <h:inputHidden value="#{logIn.userName}" id="username" />
    <h3 id="result"></h3>
</h:body>

</html>